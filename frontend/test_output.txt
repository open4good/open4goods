[info] [@nuxtjs/sitemap] `zeroRuntime` enabled - sitemap routes will be prerendered.

 RUN  v3.2.4 /home/goulven/git/open4goods/frontend

[33m[1m  âœ  MCP:     [22m[39mServer is running at http://localhost:5173/__mcp/sse
 â¯ server/plugins/sitemap-crash-repro.spec.ts (7 tests | 6 failed) 10ms
   Ã— sitemap-index plugin > handles standard nudger.fr request 5ms
     â†’ vi.mocked(...).mockReturnValue is not a function
   Ã— sitemap-index plugin > handles missing sitemapLocalFiles configuration cleanly 1ms
     â†’ vi.mocked(...).mockReturnValue is not a function
   Ã— sitemap-index plugin > handles unknown domain by falling back to default 0ms
     â†’ vi.mocked(...).mockReturnValue is not a function
   âœ“ sitemap-index plugin > handles origin being null? (impossible for URL object) 0ms
   Ã— sitemap-index plugin > handles sitemapLocalFiles being null 0ms
     â†’ vi.mocked(...).mockReturnValue is not a function
   Ã— sitemap-index plugin > handles sitemapLocalFiles[domain] being non-array 1ms
     â†’ vi.mocked(...).mockReturnValue is not a function
   Ã— sitemap-index plugin > handles sitemapLocalFiles[domain] containing non-strings 0ms
     â†’ vi.mocked(...).mockReturnValue is not a function

â¯â¯â¯â¯â¯â¯â¯ Failed Tests 6 â¯â¯â¯â¯â¯â¯â¯

 FAIL  server/plugins/sitemap-crash-repro.spec.ts > sitemap-index plugin > handles standard nudger.fr request
TypeError: vi.mocked(...).mockReturnValue is not a function
 â¯ server/plugins/sitemap-crash-repro.spec.ts:50:33
     48| 
     49|     // Mock runtime config
     50|     vi.mocked(useRuntimeConfig).mockReturnValue({
       |                                 ^
     51|       sitemapLocalFiles: {
     52|         fr: ['/tmp/sitemap.xml'],

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/6]â¯

 FAIL  server/plugins/sitemap-crash-repro.spec.ts > sitemap-index plugin > handles missing sitemapLocalFiles configuration cleanly
TypeError: vi.mocked(...).mockReturnValue is not a function
 â¯ server/plugins/sitemap-crash-repro.spec.ts:69:33
     67|     vi.mocked(getRequestURL).mockReturnValue(new URL('https://nudger.fâ€¦
     68|     // Returns object but missing sitemapLocalFiles
     69|     vi.mocked(useRuntimeConfig).mockReturnValue({})
       |                                 ^
     70| 
     71|     callback(mockCtx)

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/6]â¯

 FAIL  server/plugins/sitemap-crash-repro.spec.ts > sitemap-index plugin > handles unknown domain by falling back to default
TypeError: vi.mocked(...).mockReturnValue is not a function
 â¯ server/plugins/sitemap-crash-repro.spec.ts:80:33
     78| 
     79|     vi.mocked(getRequestURL).mockReturnValue(new URL('https://unknown.â€¦
     80|     vi.mocked(useRuntimeConfig).mockReturnValue({
       |                                 ^
     81|       sitemapLocalFiles: {
     82|         fr: ['/tmp/sitemap-fr.xml'],

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/6]â¯

 FAIL  server/plugins/sitemap-crash-repro.spec.ts > sitemap-index plugin > handles sitemapLocalFiles being null
TypeError: vi.mocked(...).mockReturnValue is not a function
 â¯ server/plugins/sitemap-crash-repro.spec.ts:104:33
    102|     const callback = runPlugin()
    103|     vi.mocked(getRequestURL).mockReturnValue(new URL('https://nudger.fâ€¦
    104|     vi.mocked(useRuntimeConfig).mockReturnValue({
       |                                 ^
    105|       sitemapLocalFiles: null,
    106|     })

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/6]â¯

 FAIL  server/plugins/sitemap-crash-repro.spec.ts > sitemap-index plugin > handles sitemapLocalFiles[domain] being non-array
TypeError: vi.mocked(...).mockReturnValue is not a function
 â¯ server/plugins/sitemap-crash-repro.spec.ts:114:33
    112|     const callback = runPlugin()
    113|     vi.mocked(getRequestURL).mockReturnValue(new URL('https://nudger.fâ€¦
    114|     vi.mocked(useRuntimeConfig).mockReturnValue({
       |                                 ^
    115|       sitemapLocalFiles: {
    116|         fr: 'not-an-array',

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/6]â¯

 FAIL  server/plugins/sitemap-crash-repro.spec.ts > sitemap-index plugin > handles sitemapLocalFiles[domain] containing non-strings
TypeError: vi.mocked(...).mockReturnValue is not a function
 â¯ server/plugins/sitemap-crash-repro.spec.ts:126:33
    124|     const callback = runPlugin()
    125|     vi.mocked(getRequestURL).mockReturnValue(new URL('https://nudger.fâ€¦
    126|     vi.mocked(useRuntimeConfig).mockReturnValue({
       |                                 ^
    127|       sitemapLocalFiles: {
    128|         fr: [null, 123, {}],

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[6/6]â¯


 Test Files  1 failed (1)
      Tests  6 failed | 1 passed (7)
   Start at  08:55:38
   Duration  7.13s (transform 4.82s, setup 6.30s, collect 63ms, tests 10ms, environment 177ms, prepare 198ms)

