@use 'sass:map'

// Variables pour les fonts
$font-family-primary: 'Poppins', 'Hanken Grotesk', sans-serif
$font-family-signature: 'Hanken Grotesk', 'Poppins', sans-serif

$font-weights: (
  thin: 100,
  light: 300,
  regular: 400,
  medium: 500,
  semibold: 600,
  bold: 700,
  extrabold: 800,
  black: 900
)

// Mapping des poids vers les noms de fichiers
$font-files: (
  100: 'Thin',
  200: 'ExtraLight',
  300: 'Light',
  400: 'Regular',
  500: 'Medium',
  600: 'SemiBold',
  700: 'Bold',
  800: 'ExtraBold',
  900: 'Black'
)

// Font metrics overrides derived from the OS/2 sTypo metrics (unitsPerEm: 1000)
// to stabilise layout when swapping from fallback fonts
$font-metrics-overrides: (
  'Poppins': (
    400: (
      'ascent-override': 105%,
      'descent-override': 35%,
      'line-gap-override': 10%,
      'size-adjust': 100%
    ),
    600: (
      'ascent-override': 105%,
      'descent-override': 35%,
      'line-gap-override': 10%,
      'size-adjust': 100%
    ),
    700: (
      'ascent-override': 105%,
      'descent-override': 35%,
      'line-gap-override': 10%,
      'size-adjust': 100%
    )
  )
)

@function resolve-font-metrics($name, $weight)
  $font-map: map.get($font-metrics-overrides, $name)

  @if $font-map != null and map.has-key($font-map, $weight)
    @return map.get($font-map, $weight)

  @return null

// Mixin pour les @font-face
@mixin font-face(
  $name,
  $weight,
  $style: normal,
  $font-folder: 'Poppins',
  $file-map: $font-files,
  $file-name: null,
  $extension: 'ttf',
  $format: 'truetype',
  $metrics: null
)
  // Résolution du nom de fichier AVANT le bloc @font-face
  $resolved-file: "#{$name}-#{map.get($file-map, $weight)}"
  $resolved-metrics: resolve-font-metrics($name, $weight)

  @if $file-name != null
    $resolved-file: $file-name

  @if $metrics != null
    $resolved-metrics: $metrics

  @if $file-name == null and $style == italic
    @if $resolved-file == 'Poppins-Regular'
      $resolved-file: 'Poppins-Italic'
    @else
      $resolved-file: '#{$resolved-file}Italic'

  @font-face
    font-family: $name
    font-style: $style
    font-weight: $weight
    font-display: swap
    src: url('~/assets/fonts/#{$font-folder}/#{$resolved-file}.#{$extension}') format($format)
    @if $resolved-metrics != null
      ascent-override: map.get($resolved-metrics, 'ascent-override')
      descent-override: map.get($resolved-metrics, 'descent-override')
      line-gap-override: map.get($resolved-metrics, 'line-gap-override')
      size-adjust: map.get($resolved-metrics, 'size-adjust')

// Génération automatique des @font-face pour Poppins (ttf)
@each $weight-name, $weight-value in $font-weights
  @include font-face('Poppins', $weight-value)
  @include font-face('Poppins', $weight-value, italic)

// Hanken Grotesk en woff2 (poids regular normal + italic)
@include font-face(
  'Hanken Grotesk',
  map.get($font-weights, 'regular'),
  normal,
  $font-folder: 'HankenGrotesk',
  $file-name: 'HankenGrotesk-Regular',
  $extension: 'woff2',
  $format: 'woff2'
)

@include font-face(
  'Hanken Grotesk',
  map.get($font-weights, 'regular'),
  italic,
  $font-folder: 'HankenGrotesk',
  $file-name: 'HankenGrotesk-Italic',
  $extension: 'woff2',
  $format: 'woff2'
)

// Application des fonts via variables CSS
:root
  --font-family-base: #{$font-family-primary}
  --font-family-signature: #{$font-family-signature}

// Thème spécifique (ex : nudger)
.v-theme--light
  --font-family-base: #{$font-family-primary}

html, body
  font-family: var(--font-family-base)

// Force Vuetify à utiliser la font de base
.v-application
  font-family: var(--font-family-base) !important
