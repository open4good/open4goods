name: Lighthouse Manual Audit

on:
    workflow_dispatch:
        inputs:
            urls:
                description: "URLs to audit (one per line)"
                default: "https://nudger.fr/"
                required: true

permissions:
    contents: write

jobs:
    lighthouse:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v6

            - name: Setup Node
              uses: actions/setup-node@v6
              with:
                  node-version: 24

            - name: Run Lighthouse CI
              uses: treosh/lighthouse-ci-action@v12
              with:
                  urls: ${{ inputs.urls }}
                  configPath: ./.lighthouserc.json
                  uploadArtifacts: true

            - name: Process Lighthouse reports
              run: node scripts/lighthouse/process-lighthouse.mjs --input-dir .lighthouseci --output-dir lighthouse --history-file lighthouse/HISTORY.md --latest-dir lighthouse/latest --badges-dir lighthouse/badges

            - name: Commit Lighthouse reports
              uses: stefanzweifel/git-auto-commit-action@v7
              with:
                  commit_message: "chore(lighthouse): update reports"
                  file_pattern: lighthouse/ README.md
