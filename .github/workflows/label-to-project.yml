name: Auto add issue to GitHub Project when labeled

on:
  issues:
    types: [labeled]

jobs:
  add-to-project:
    runs-on: ubuntu-latest
    steps:
      - name: Add issue to the right project(s) based on label(s)
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            // ðŸ› ï¸ CONFIGURATION : associe les labels aux IDs des projets classiques
            const labelToProjectMap = {
              'squad:ux': 4
            };

            const issue = context.payload.issue;
            const label = context.payload.label.name;

            const projectId = labelToProjectMap[label];
            if (!projectId) {
              console.log(`Aucun projet associÃ© au label : ${label}. Fin.`);
              return;
            }

            console.log(`Label "${label}" dÃ©tectÃ©. Ajout de l'issue #${issue.number} au projet ${projectId}...`);

            // ðŸ” Liste les colonnes pour trouver "No Status"
            const { data: columns } = await github.rest.projects.listColumns({
              project_id: projectId
            });

            const column = columns.find(c => c.name === 'No Status');
            if (!column) {
              throw new Error(`La colonne "No Status" est introuvable dans le projet ${projectId}.`);
            }

            // âœ… Ajoute la carte Ã  la colonne
            await github.rest.projects.createCard({
              column_id: column.id,
              content_id: issue.id,
              content_type: 'Issue'
            });

            console.log(`âœ… Issue ajoutÃ©e dans la colonne "No Status" du projet ${projectId}.`);
