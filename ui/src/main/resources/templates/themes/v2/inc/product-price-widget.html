<!--/* Main section: Affichage du prix neuf et historique, incluant les graphiques et offres */-->
<section role="main" aria-label="Prix (neuf moins chers et √©volution) du produit">
    <div th:if="${priceHistory}" >
        <div class="m-4 card shadow border-gray-300 text-center">
    
            <div class="row text-center justify-content-center mt-4 mb-4">
                <div class="col-md-8">
                    <h2 class="display-4">Prix neufs</h2>
                </div>
            </div>
    
            <th:block>
                <!--/* Bloc messages et informations d'offres */-->
                <div class="row">
                    <div class="col-4">
                        <div class="ms-4 card offer-link occasion-card"
                             th:data-token="${offer.affiliationToken}"
                             data-offer-type="occasion"
                             th:classappend="' selected'">
                            <div class="card-body text-center">
                                <h6 class="text-muted">Meilleur prix</h6>
                                <div class="d-flex align-items-center justify-content-center mb-3">
                                    <img th:replace="inc/favicon :: remoteFavicon(${offer.datasourceName}, 32)" alt="Favicon de l'offre"/>
                                    <h5 class="mb-0" th:text="${offer.datasourceName}"></h5>
                                </div>
                                <div class="text-success d-flex justify-content-center align-items-baseline mb-0">
                                    <h2 class="display-4 fw-bold mb-0" th:text="${offer.shortPrice()}">0</h2>
                                    <span class="ms-2" th:text="#{'symbol.'+${offer.currency}}"></span>
                                </div>
                            </div>
                        </div>
                    </div>
    
                    <div class="col-8">
                        <div th:if="${product.price.isHistoricalLowest(offer)}" class="card shadow me-4">
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <div class="col-2 text-center">
                                        <img src="/icons/medal.png" alt="Ic√¥ne prix le plus bas historique"/>
                                    </div>
                                    <div class="col-10">
                                        <h3 class="h4 mb-3">Prix le plus bas historique !</h3>
                                        <p class="mb-0">
                                            Nous n'avons jamais relev√© de prix neuf aussi bas pour le 
                                            <span th:text="${product.brandAndModel()}"></span>.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
    
                        <div th:unless="${product.price.isHistoricalLowest(offer)}" class="card shadow me-4">
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <div class="col-6 text-center">
                                        <h3 class="h4 mb-3">Historique</h3>
                                        <i class="fa fa-history" aria-hidden="true"></i>
                                    </div>
                                    <div class="col-6">
                                        <div class="d-block ms-auto">
                                            <div class="d-flex align-items-center text-right mb-2">
                                                <span class="shape-xs rounded-circle bg-dark me-2"></span>
                                                <span class="fw-normal small">
                                                    Prix le plus bas : 
                                                    <b th:text="${product.price.getHistoryLowest(priceCondition) != null ? product.price.getHistoryLowest(priceCondition).price : 'N/A'}"></b>
                                                </span>
                                            </div>
                                            <div class="d-flex align-items-center text-right mb-2">
                                                <span class="shape-xs rounded-circle bg-tertiary me-2"></span>
                                                <span class="fw-normal small">
                                                    Prix moyen : 
                                                    <b th:text="${product.price.getHistoryAverage(priceCondition) != null ? #numbers.formatDecimal(product.price.getHistoryAverage(priceCondition), 2, 2) : 'N/A'}"></b>
                                                </span>
                                            </div>
                                            <div class="d-flex align-items-center text-right mb-2">
                                                <span class="shape-xs rounded-circle bg-primary me-2"></span>
                                                <span class="fw-normal small">
                                                    Prix le plus haut : 
                                                    <b th:text="${product.price.getHistoryHighest(priceCondition) != null ? product.price.getHistoryHighest(priceCondition).price : 'N/A'}"></b>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
    
                    </div>
                </div>
    
                <div class="m-4">
                    <div th:if="${trend.trend == 0}" class="text-center alert alert-info" role="alert">
                        üò∂‚Äçüå´Ô∏è Le prix neuf est stable depuis <span th:text="${trend.formatedDuration()}"></span>
                    </div>
                    <div th:if="${trend.trend == 1}" class="text-center alert alert-tertiary" role="alert">
                        üßê Le prix neuf a augment√© de <b>
                            <span th:text="${#numbers.formatDecimal(trend.variation == null ? 0 : trend.variation, 0, 0)}"></span>‚Ç¨
                        </b> depuis le dernier pointage (<span th:text="${trend.formatedDuration()}"></span>)
                    </div>
                    <div th:if="${trend.trend == -1}" class="text-center alert alert-success" role="alert">
                        Le prix neuf a baiss√© de <b>
                            <span th:text="${#numbers.formatDecimal(trend.variation == null ? 0 : trend.variation, 0, 0)}"></span>‚Ç¨
                        </b> depuis le dernier relev√© (<span th:text="${trend.formatedDuration()}"></span>) üòä
                    </div>
                </div>
    
            </th:block>
    
            <canvas class="m-4" th:id="|${widgetPrefix}PriceChart|"></canvas>
    
            <div class="text-center">
                <div class="btn-group my-3" role="group" aria-label="S√©lection de la p√©riode">
                    <!--/* TODO: Apply a light transparency on unselected items to highlight selected period */-->
                    <button type="button" class="mx-2 btn btn__nudger period-btn" th:id="|btn-${widgetPrefix}-15days|">15 jours</button>
                    <button type="button" class="mx-2 btn btn__nudger period-btn active-period-btn" th:id="|btn-${widgetPrefix}-3months|">3 mois</button>
                    <button type="button" class="mx-2 btn btn__nudger period-btn" th:id="|btn-${widgetPrefix}-6months|">6 mois</button>
                    <button type="button" class="mx-2 btn btn__nudger period-btn" th:id="|btn-${widgetPrefix}-max|">Max</button>
                </div>
            </div>
    
    
            <h3 class="mt-4 display-4">Toutes les offres</h3>
            
            
            <div class="m-4 table-responsive-sm">
                <table th:id="|${widgetPrefix}-offers|" class="table table-hover bg-white">
                    <thead>
                        <tr>
                            <th scope="col"></th>
                            <th scope="col">Marchand</th>
                            <th scope="col">Prix</th>
                            <th scope="col">Mise √† jour</th>
                        </tr>
                    </thead>
                    <tbody>
                        <th:block th:each="offer, stats : ${offers}">
                            <tr class="p-3 align-middle offer-link"
                                th:data-token="${offer.affiliationToken}"
                                th:data-compensation="${offer.compensation}">
                                <td class="p-0 infos-text">
                                    <span class="p-3 d-inline-flex">
                                        <img th:replace="inc/favicon :: remoteFavicon(${offer.datasourceName}, 16)" alt="Favicon de l'offre"/>
                                    </span>
                                </td>
                                <td class="p-0 infos-text" data-bs-toggle="tooltip" data-bs-placement="top" th:title="${offer.offerName}" nowrap>
                                    <span class="h-100 d-flex align-items-center">
                                        <span th:text="${offer.datasourceName}"></span>
                                    </span>
                                </td>
                                <td class="p-0 infos-text infos-text-secondary text-center">
                                    <span th:text="${offer.price}"></span> 
                                    <span th:text="#{'symbol.'+${offer.currency}}"></span>
                                </td>
                                <td class="p-0 pe-3 text-end">
                                    <span th:text="${offer.formatedDuration()}"></span>
                                </td>
                            </tr>
                        </th:block>
                    </tbody>
                </table>
            </div>
    
        </div>
    </div>
</section>
