<!DOCTYPE html>
<html th:lang="${siteLocale.language}">

<head>

	<!--/* Metas and CSS */-->
	<th:block th:insert="~{inc/header-meta.html}"></th:block>
    
	<!-- Primary Meta Tags -->
	<title th:text="#{index.title}"></title>
	<meta name="title" th:content="#{index.meta.title}">
	<meta name="description" th:content="#{index.meta.description}">
		
	<!-- Open Graph / Facebook -->
	<meta property="og:type" content="website">
	<meta property="og:url" th:content="${url}">
	<meta property="og:title" th:content="#{index.title}">
	<meta property="og:description" th:content="#{index.meta.description}">
	<meta property="og:image" th:content="${url} + 'assets/img/brand/light.svg'">
	
	<!-- Twitter -->
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:url" th:content="${url}">
	<meta name="twitter:title" th:content="#{index.title}">
	<meta name="twitter:description" th:content="#{index.meta.description}">
	<meta name="twitter:image" th:content="${url} + 'assets/img/brand/light.svg'">

	<link rel="stylesheet" type="text/css" href="/webjars/datatables/css/dataTables.bootstrap5.min.css">
	
	<style>
	tbody, td, tfoot, th, thead, tr {
    	 border-style: none;
	}	
	
	</style>
	
</head>

<body>
    
	<!--/* Navbar */-->
	<th:block th:insert="~{inc/navbar/navbar-non-product.html}"></th:block>
    <!--/* Loader */-->
    <th:block th:insert="~{inc/preloader.html}"></th:block>
	
    <main>	
  
        <div class="section bg-gray-200">
            <div class="container container-semi-fluid">

				<!--/* Hero */-->						
				<div class="row mb-3">							
					<div class="">
						<!--div class="col-lg-2 text-center">
								<img class="mt-2" width="150" th:src="${config.verticalHomeLogo.i18n(siteLanguage)}">
						</div-->
						<h1 class="mb-3 text-center" th:text="${config.verticalHomeTitle.i18n(siteLanguage)}"></h1>

						<p class="text-center">
							<th:block th:with="path=${vertical} + '/welcome-header'">
								<th:block th:insert="~{inc/wiki.html}"></th:block>
							</th:block>
						</p>
					</div>
				</div>
						
                <div class="container">
                
                	<hr>
					<div class="mb-3">
						<button class="btn btn-outline-primary mb-sm-3 mb-lg-0" type="button" data-bs-toggle="modal" data-bs-target="#modal-guides">Les guides</button>
						<button class="btn btn-outline-primary mb-sm-3 mb-lg-0 mx-md-3" type="button" data-bs-toggle="modal" data-bs-target="#modal-eco-filtres">Eco-Filtres</button>
						<button class="btn btn-outline-primary mb-lg-0 mb-sm-3" type="button" data-bs-toggle="modal" data-bs-target="#modal-filtres">Filtres</button>
					</div>  
					<hr>		
					<div class="modal fade" id="modal-guides" tabindex="-1" role="dialog" aria-labelledby="modal-guides" aria-hidden="true">
						<div class="modal-dialog modal-dialog-centered" role="document">
							<div class="modal-content">
								<div class="modal-header">
									<h2 class="h6 modal-title">Les guides</h2>
									<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
								</div>
								<div class="modal-body">
									<ul class="list-group list-group-flush price-list">
										<li class="list-group-item border-0"><img height="16" width="16" class="me-2" src="/icon/fnac.com" title="icône fnac"><a href="http://nudger.fr/televiseurs/impact-ecologique-televiseurs">Téléviseurs : quel impact écologique ?</a> </li>
										<li class="list-group-item border-0"><span class="fas fa-box"></span><a href="https://nudger.fr/televiseurs/comment-trouver-televiseur-ecologique">Bien choisir sa TV ! </a></li>
										<li class="list-group-item border-0"><span class="fas fa-clock"></span><a href="https://nudger.fr/televiseurs/quelle-difference-qled-oled">OLED, QLED, LCD : Les différences</a> </li>
									</ul>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-link text-gray ms-auto" data-bs-dismiss="modal">Close</button>
								</div>
							</div>
						</div>
					</div>

					<div class="modal fade" id="modal-eco-filtres" tabindex="-1" role="dialog" aria-labelledby="modal-eco-filtres" aria-hidden="true">
						<div class="modal-dialog modal-dialog-centered" role="document">
							<div class="modal-content">
								<div class="modal-header">
									<h2 class="h6 modal-title">Eco-Filtres</h2>
									<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
								</div>
								<div class="modal-body">
									<th:block th:insert="~{inc/vertical-filters-eco.html}"></th:block>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-link text-gray ms-auto" data-bs-dismiss="modal">Close</button>
								</div>
							</div>
						</div>
					</div>

					<div class="modal fade" id="modal-filtres" tabindex="-1" role="dialog" aria-labelledby="modal-filtres" aria-hidden="true">
						<div class="modal-dialog modal-dialog-centered" role="document">
							<div class="modal-content">
								<div class="modal-header">
									<h2 class="h6 modal-title">Filtres</h2>
									<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
								</div>
								<div class="modal-body">
									<th:block th:insert="~{inc/vertical-filters.html}"></th:block>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-link text-gray ms-auto" data-bs-dismiss="modal">Close</button>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!--/* Right column */-->
				<div class="col-12 mb-3">
					<th:block th:insert="~{inc/vertical-table.html}"></th:block>
				</div>
        	</div>
       	</div>
    </main>

	<!--/* Footer */-->
	<th:block th:insert="~{inc/footer.html}"></th:block>	

<!-- Core -->
<script src="/webjars/bootstrap/js/bootstrap.min.js"></script>
<script src="../../vendor/headroom.js/dist/headroom.min.js"></script>

<!-- Vendor JS -->

<script src="../../vendor/smooth-scroll/dist/smooth-scroll.polyfills.min.js"></script>
<script src="../../vendor/vivus/dist/vivus.min.js"></script>
<script src="/webjars/jquery/jquery.min.js"></script>

<script type="text/javascript" language="javascript" src="/webjars/datatables/js/jquery.dataTables.js"></script>
<script type="text/javascript" language="javascript" src="/webjars/datatables/js/dataTables.bootstrap5.min.js"></script>

<script src="../../vendor/nouislider/distribute/nouislider.min.js"></script>

<!-- pixel JS -->
<script src="../../assets/js/pixel.js"></script>

<!-- custom sources -->
<script src="../../assets/js/pixel-custom.js"></script>

<script src="/webjars/mustache/mustache.min.js"></script>

<!-- Ajax loaded table template -->
<div id="tpl_place" class="hidden"></div>

<!-- Setting up variables -->
<script th:inline="javascript">
	/*<![CDATA[*/
	
	    const vertical = /*[[${config.id}]]*/ '';
	    const siteLanguage = /*[[${siteLanguage}]]*/'';
	    const baseUrl = /*[[${baseUrl}]]*/'';
	    const verticalPath = /*[[${verticalPath}]]*/'';
	    const additionalAttributes = /*[[${filters}]]*/'';
	    const tpl = /*[[${tpl}]]*/'';	    
	    	    	    
	/*]]>*/
</script>

<script>

   var dummyRender = function(cell, type, data) {return  "" ;}
   
   var columns = [
       { 
       	"data": "attributes.referentielAttributes.MODEL.keyword", 
       	"name" : "Modèle",
       	"title" : "Modèle",
       	render: function(cell, type, data) {
				var template = $('#template-product-search').html();
				Mustache.parse(template);

				return Mustache.render(template, {
					data : data,
					vertical: vertical,
  					productUrl : baseUrl+verticalPath+'/'+data.names.name,
  					imageUrl : baseUrl+'images/'+data.attributes.referentielAttributes.GTIN+'-cover.png',           					
					name : (data.attributes.referentielAttributes.MODEL == null ? data.names.name : data.attributes.referentielAttributes.MODEL)
				});                	
       	}
       },
       
       { 
       	"data": "attributes.referentielAttributes.BRAND.keyword", 
       	"name" : "Marque",
       	"title" : "Marque",
       	render: function(cell, type, data) {
               return  "" ;
           }
       },
       { "data": "id", "name" : "Ecoscore", "title" : "Ecoscore"  },
       { "data": "price.minPrice.price", "name" : "Prix", "title" : "Prix"  },
       { "data": "offersCount", "name" : "Concurrence", "title" : "Concurrence"  }
           ];

	 	for ( i = 0; i <  additionalAttributes.length; i++) {						
			columns[i+5] = JSON.parse('{ "data": "attributes.aggregatedAttributes.'+additionalAttributes[i]['key']+'.value.keyword", "name" : "'+additionalAttributes[i]['name'][siteLanguage]+'", "title" : "'+additionalAttributes[i]['name'][siteLanguage]+'"  }');
			columns[i+5].render = dummyRender;
	 	}
	 
	<!-- Datatable init function -->
	var table;
	
	function initDatatable () {
		
		return $('#tableProducts').DataTable({
			
			order: [ [4, 'desc'] ],
	    	searching: false,
	        "bLengthChange": false,	 
	        "processing": true,
	        "serverSide": true,
	        "orderMulti": false,
	        "pageLength": 10,
	        "ajax": {
	            "url": "/"+verticalPath+"/paginated",
	            "dataSrc": "data",
	            "data": function ( data ) {
	            	// Adding slider rangers attributes
	            	var sliderParameters = new Array();
	            	$('.input-slider-range-container').each (function (e) {
	            		sliderParameters.push( $(this).attr("id") + ":" + $(this).attr('data-range-value-min') + " : " + $(this).attr('data-range-value-max'));	            		
		            	} 
	            	);	            	
	            	data.sliders=sliderParameters;
	            	
	            	// Adding checkboxes attributes
	            	var checkboxesParameters = new Array();
	            	$('input:checked').each (function (e) {	            	
	            		checkboxesParameters.push( $(this).attr("id"));	            				            	
	            		} 
	            	);	
	            	data.checkboxes=checkboxesParameters;

	 				return data;
	         }},
	         
	         createdRow: function(row, data, dataIndex){
	                 // Add COLSPAN attribute
	                 $('td:eq(0)', row).attr('colspan', 9);	                 
					 for ( i = 1; i < 5+ additionalAttributes.length; i++) {						
	                 	$('td:eq('+i+')', row).css('display', 'none');
					 }
	         },
	         
	        "columns": columns 
	 	});
	};

	// On document Load
	$(document).ready(function() {
		
		// Loading templates 
		$.ajax({
			url : '/tpl_table'+tpl+'.html',
			dataType : 'html',
			cache : true, // otherwise will get fresh copy every page load
			success : function(e) {
				// script loaded, do stuff!
				$("#tpl_place").html(e);

				// Init table 			
	    		table = initDatatable();
			}
		});
				
		// Range sliders listener
		var slidersCounter = $('.input-slider-range-container').length;
	    $('.input-slider-range-container').on('change', function(e) {
	    		    	
	    	// this change function is called on page load (component js init)
	    	// This counter ensure the datatble is not drawn on page load
	    	if (slidersCounter <= 0) {	    		
				table.draw();				
	    	} else {
	    		slidersCounter--;
	    	}
	    	
		});

	    // Checkboxes listener
	    $('input:checkbox').click(function() { 
			table.draw();					    	
	   	});
		
	} );
</script>

</body>

</html>
